<div class="chat-container">

  <!-- Messages -->
  <div class="chat-messages" #messagesContainer>
  <!-- Welcome / empty state -->
  <div class="message assistant" *ngIf="messages.length === 0 && !uploading && !thinking">
    Hi ðŸ‘‹ Upload an EDI CSV and ask questions.
  </div>
  <div
    *ngFor="let msg of messages"
    class="message-row"
    [class.user]="msg.role === 'user'"
    [class.assistant]="msg.role === 'assistant'"
  >
    <div class="message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
      {{ msg.content }}
    </div>
  </div>

  <!-- âœ… Upload indicator -->
  <div class="message assistant thinking" *ngIf="uploading">
    Uploading CSVâ€¦
  </div>

  <!-- AI thinking indicator -->
  <div class="message assistant thinking" *ngIf="thinking">
    Thinkingâ€¦
  </div>
</div>


  <!-- Input -->
  <div class="chat-input-bar">

    <input
      type="file"
      #fileInput
      accept=".csv"
      hidden
      (change)="onFileSelected($event)"
    />

    <button class="icon-btn" (click)="fileInput.click()">ï¼‹</button>

    <div class="file-chip" *ngIf="selectedFile">
      {{ selectedFile.name }}
      <button (click)="removeFile()">âœ•</button>
    </div>

    <input
      class="chat-input"
      type="text"
      [placeholder]="uploading ? 'Uploading CSVâ€¦ please wait' : (csvUploaded ? 'Ask about the uploaded EDI dataâ€¦' : 'Upload a CSV to start chatting')"
      [disabled]="!csvUploaded || uploading || thinking"
      [(ngModel)]="question"
      (keydown.enter)="send()"
    />

    <button class="send-btn" (click)="send()" [disabled]="!csvUploaded || uploading || thinking">âž¤</button>
  </div>
</div>
